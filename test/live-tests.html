<!DOCTPYE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="utf-8"/>
    <title>Live Tests</title>

</head>
<body>
    <main>
        <h1>Live Tests</h1>
        <p>Examples for testing focus on whether an Assistive Technology (AT) will correctly announce <strong>Live Regions</strong> on dynamic updates.</p>
        <strong>Notes</strong>
        <ul>
            <li>Live updates announce the related aria-labelledby or aria-label with <em>each update</em>. Keep it brief to avoid being annoying.</li>
            <li>DOM Inline additions (Text, Span..) cause Elements current contents plus addition to be read on the update (even if default atomic=false).</li>
            <li>DOM Block and Inline-Block additions cause only the Block's content to be read on the update (with atomic=false)</li>
            <li>DOM addition Styling changes behavior, addition treated as above Inline vs Block/Inline-Block described above.</li>
        </ul>

        <section>
            <h2>Live Region Defaults</h2>
            <p>Should announce only new content added to an element based on the <em>defaults aria-relevant="additions text" aria-atomic="false"</em></p>

            <h3>aria-live=polite</h3>
            <p>Polite updates announced below. <button id="live-polite-button">Start Polite updates</button></p>
            <div aria-live=polite id="live-polite" aria-label="Polite update"></div>
            
            <h3>aria-live=assertive</h3>
            <p>Assertive updates announced below. <button id="live-assertive-button">Start Assertive updates</button></p>
            <div aria-live=assertive id="live-assertive" aria-label="Assertive update"></div>
        </section>

        <section>
            <h2>(TODO) Live Region Relevant</h2>
            <p>Regions below have a aria-live=polite with a custom aria-relevant.</p>
            <div><label>Click to <button id="live-YYY-button">Enable aria-relavant="additions"</button></label>. <span id="live-YYY-label">aria-relavant="additions" updates announced here:</span> <span aria-live=polite id="live-YYYY" aria-labelledby="live-YYY-label"></span></div>
            <div><label>Click to <button id="live-YYY-button">Enable aria-relavant="removals"</button></label>. <span id="live-YYY-label">aria-relavant="removals" updates announced here:</span> <span aria-live=polite id="live-YYYY" aria-labelledby="live-YYY-label"></span></div>
            <div><label>Click to <button id="live-YYY-button">Enable aria-relavant="text"</button></label>. <span id="live-YYY-label">aria-relavant="text" updates announced here:</span> <span aria-live=polite id="live-YYYY" aria-labelledby="live-YYY-label"></span></div>
        </section> 
        
        <section>
            <h2>(TODO) Live Region Atomic</h2>
            <p>Regions below have a aria-live=polite with a custom aria-atomic.</p>
            <div><label>Click to <button id="live-YYY-button">Enable aria-atomic="false"</button></label>. <span id="live-YYY-label">aria-atomic="false" updates announced here:</span> <span aria-live=polite id="live-YYYY" aria-labelledby="live-YYY-label"></span></div>
            <div><label>Click to <button id="live-YYY-button">Enable aria-atomic="true"</button></label>. <span id="live-YYY-label">aria-atomic="true" updates announced here:</span> <span aria-live=polite id="live-YYYY" aria-labelledby="live-YYY-label"></span></div>
        </section>
        
        <section>
            <h2>Live Region Roles</h2>

            <section>
                <h3>role=log</h3>
                <p>Adds an elements to the log below. <button id="role-log-button">Start adding elements to log</button> </p>
                <ul role=log aria-label="log update" id="role-log-el"></ul>
            </section>

            <div><label>Click to <button id="live-YYY-button">Enable role="status"</button></label>. <span id="live-YYY-label">role="status" updates announced here:</span> <span aria-live=polite id="live-YYYY" aria-labelledby="live-YYY-label"></span></div>  
            <div><label>Click to <button id="live-YYY-button">Enable role="alert"</button></label>, note default aria-live=assertive. <span id="live-YYY-label">role="alert" updates announced here:</span> <span aria-live=polite id="live-YYYY" aria-labelledby="live-YYY-label"></span></div>
            <div><label>Click to <button id="live-YYY-button">Enable role="marquee"</button></label>. <span id="live-YYY-label">role="marquee" updates announced here:</span> <span aria-live=polite id="live-YYYY" aria-labelledby="live-YYY-label"></span></div>
            <div><label>Click to <button id="live-YYY-button">Enable role="timer"</button></label>. <span id="live-YYY-label">role="timer" updates announced here:</span> <span aria-live=polite id="live-YYYY" aria-labelledby="live-YYY-label"></span></div>
        </section>
    </main>

    <hr>

    <asside aria-labelledby="log-of-testing-title">
        <h2 id="log-of-testing-title">Log of Testing</h2>
        <p>Tested on Windows 10 with combinations of screen readers Jaws, NVDA, Narrator, ChromeVox and browsers Chrome, Edge, FF, IE11.</p>
        <ol>
            <li>Date: TODO</li>
        </ol>
    </asside>

    <script>
        document.addEventListener('DOMContentLoaded', function() {


            function updateTextElement({parentEl, childEl=document.createElement('div'), styleAsInline=true, content=document.createTextNode('1'), delay=1000, max=20}) {
                let count = 0;
                function run() {
                    setTimeout(run, delay);
                    count++;
                    if (count <= max) doUpdate();
                }
                function doUpdate(){
                    // Note: Span/textNode treated as Inline & read as whole. 
                    // Must be added to DOM as a block element to read as a distinct addition.
                    const myChildEl = childEl.cloneNode(true);
                    // Note: Appending the same node, will just overwrite/ignore that node. 
                    // Clone it so added to DOM as epected. Weird..
                    myChildEl.appendChild(content.cloneNode(true));
                    if (styleAsInline) {
                        myChildEl.style.display = 'inline-block';
                    }
                    parentEl.appendChild(myChildEl);
                }
                run();
            }

             //live-polite
            const livePolite = document.querySelector('#live-polite');
            const livePoliteButton = document.querySelector('#live-polite-button');
            livePoliteButton.addEventListener('click', () => updateTextElement({parentEl: livePolite, delay: 500, max: 50}));

            //live-assertive
            const liveAssertive = document.querySelector('#live-assertive');
            const liveAssertiveButton = document.querySelector('#live-assertive-button');
            liveAssertiveButton.addEventListener('click', () => updateTextElement({parentEl: liveAssertive, content: document.createTextNode('a')}));

            //role-log
            const roleLogContent = document.querySelector('#role-log-el');
            const roleLogButton  = document.querySelector('#role-log-button');
            roleLogButton.addEventListener('click', () => updateTextElement({parentEl: roleLogContent, childEl: document.createElement('li')}));         


    });
    </script>
</body>
</html>
